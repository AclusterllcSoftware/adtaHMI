<%- include('header', {currentMenu: 'general-view-motors', pageTitle: 'Motors'}); %>
    <div class="row m-0 mt-1">
        <div class="col-4" style="padding:0 50px;text-align: center;">
			<%- include('resources/general-view-colors.svg') %>
        </div>
		<div class="col-8  position-relative" style="padding:0 10px;text-align: center;">
			<%- include('resources/general-view-motors.svg') %>
            <div class="position-absolute" style="right: 100px;top:50px;z-index: 1"><%- include('components/machine_command_buttons'); %></div>
		</div>
    </div>
    <div class="row m-0">
        <div class="col-lg-12 pt-0 pb-0 pl-2 pr-2 mt-2">
            <%- include('components/active_alarm_content') %>
        </div>
    </div>
</div>
<%- include('footer', {currentMenu: 'general-view-motors'}); %>
<script src="js/jquery-bootstrap.js"></script>
<script src="js/jquery.newsTicker.js"></script>
<script src="js/daterangepicker/moment.min.js"></script>
<script src="js/nav.js"></script>

<script>
let basic_info={}


jQuery(document).ready(function() {
	$('[data-toggle="tooltip"]').tooltip();
    loadAndGetDetailedActiveAlarmSettings();//nav.js
	
    jQuery("#ip_list_dropdown").change(function() {
        selected_machine = jQuery(this).val();
        if(selected_machine !== "") {
            let selected_machine_name = machine_list[selected_machine];
            jQuery("#display_machine_name").text(selected_machine_name);
        }
        else {
            jQuery("#display_machine_name").text("Select a machine");
            selected_machine = 0;
        }
        ipcRenderer.send("get:views", selected_machine, "general-view-motors");
    });
});

ipcRenderer.on("render:general-view-motors", function(e, data) {
    basic_info=data;
    setBinsLabel(data['binsInfo']);//nav.js
    setEstopsLabel(data['inputsInfo']);//nav.js
    setDevicesLabel(data['devicesInfo']);//nav.js
    setConveyorsLabel(data['conveyorsInfo']);//nav.js

    $('.bin.cursor-pointer').on('click',function (){
        let key=$(this).attr('bin-key');
        ipcRenderer.send("render:general-view-bin-details", selected_machine,key);
    })
    setInterval(() => {
        ipcRenderer.send("sendRequest", selected_machine,'getGeneralMotorsViewData', {});
    }, 1000);
});
ipcRenderer.on("getGeneralMotorsViewData", function(e, data) {
    let machineId=data['machineId'];
    setBinsStates(machineId,data['binsStates'],basic_info['binsInfo']);//nav.js
    setConveyorsStates(machineId,data['conveyorsStates'],basic_info['conveyorsInfo']);//nav.js
    setActiveAlarms(machineId,data['activeAlarms'],basic_info['alarmsInfo'])//nav.js

});
</script>
</body>
</html>